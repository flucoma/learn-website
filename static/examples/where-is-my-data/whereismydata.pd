#N canvas 66 51 1325 669 12;
#N canvas 0 113 1102 625 makesine 0;
#X obj 271 169 until;
#X obj 271 243 / 20;
#X obj 271 267 * 3.1415;
#X obj 271 291 sin;
#X obj 271 315 tabwrite sinebuf, f 17;
#X obj 271 339 array define sinebuf 1024;
#X obj 271 195 f;
#X obj 302 195 + 1;
#X obj 271 96 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 271 120 t b b, f 7;
#X msg 271 144 1024;
#X msg 317 169 0;
#X obj 271 219 t f f, f 17;
#X obj 176 21 loadbang;
#X obj 176 72 t b b, f 14;
#X obj 176 363 fluid.bufcompose -source sinebuf -destination testsignal -deststartframe 1024 -gain 0.1;
#X obj 176 401 array define testsignal 3072;
#X obj 176 45 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X connect 0 0 6 0;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 6 0 7 0;
#X connect 6 0 12 0;
#X connect 7 0 6 1;
#X connect 8 0 9 0;
#X connect 9 0 10 0;
#X connect 9 1 11 0;
#X connect 10 0 0 0;
#X connect 11 0 6 1;
#X connect 12 0 1 0;
#X connect 12 1 4 1;
#X connect 13 0 17 0;
#X connect 14 0 15 0;
#X connect 14 1 8 0;
#X connect 17 0 14 0;
#X restore 417 290 pd makesine;
#X obj 151 223 fluid.bufpitch -source testsignal -features pitch -fftsettings 1024, f 68;
#X obj 417 267 array define pitch;
#X obj 151 245 t b b;
#X obj 151 314 fluid.bufcompose -source pitch -destination confidence -startchan 1, f 67;
#X obj 151 198 bng 19 250 50 0 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000;
#X obj 417 245 clone 2 fluid.multiarray pitch;
#X obj 151 361 fluid.waveform 500 180 1 empty empty 0;
#X msg 151 338 waveform testsignal source \, features confidence red;
#X msg 183 267 0;
#X obj 196 245 array define confidence;
#X obj 183 291 array size confidence;
#X obj 60 109 vradio 19 1 0 3 empty empty empty 0 -10 0 12 #fcfcfc #000000 #000000 0;
#X text 82 110 0:None;
#X text 81 128 1:Default;
#X text 81 147 2: Full;
#X obj 60 171 t b b b f, f 20;
#X msg 197 198 padding \$1;
#N canvas 245 545 450 300 fftsettings 0;
#X obj 59 24 inlet;
#X obj 59 81 pack f f, f 13;
#X obj 59 105 t b l, f 13;
#X obj 115 25 inlet;
#X obj 115 48 t b f;
#X msg 147 129 fftsettings \$1 \$2 -1;
#X obj 147 153 outlet;
#X obj 59 129 s rpad;
#X obj 159 48 s hop;
#X obj 17 48 s win;
#X connect 0 0 1 0;
#X connect 0 0 9 0;
#X connect 1 0 2 0;
#X connect 2 0 7 0;
#X connect 2 1 5 0;
#X connect 3 0 4 0;
#X connect 3 0 8 0;
#X connect 4 0 1 0;
#X connect 4 1 1 1;
#X connect 5 0 6 0;
#X restore 288 198 pd fftsettings;
#X obj 60 84 r rpad;
#X floatatom 288 173 5 0 0 0 - - - 0;
#X floatatom 383 173 5 0 0 0 - - - 0;
#X msg 26 84 0;
#X obj 26 58 loadbang;
#X obj 288 123 loadbang;
#X msg 288 149 1024;
#X obj 383 123 loadbang;
#X msg 383 149 512;
#X obj 100 198 s calc;
#N canvas 411 436 764 300 outputs 0;
#X obj 43 16 inlet;
#X obj 265 64 array get confidence;
#X obj 488 65 array get pitch;
#X obj 265 88 outlet;
#X obj 488 89 outlet;
#X obj 43 88 outlet;
#X obj 43 64 array size confidence;
#X obj 43 40 t b b b, f 64;
#X connect 0 0 7 0;
#X connect 1 0 3 0;
#X connect 2 0 4 0;
#X connect 6 0 5 0;
#X connect 7 0 6 0;
#X connect 7 1 1 0;
#X connect 7 2 2 0;
#X restore 60 523 pd outputs;
#X listbox 127 589 75 0 0 0 - - - 0;
#X listbox 127 568 75 0 0 0 - - - 0;
#X listbox 127 547 75 0 0 0 - - - 0;
#X text 656 547 Pitch;
#X text 655 567 Confidence;
#X text 656 589 Windows;
#X obj 981 139 r calc;
#X floatatom 981 162 5 0 0 0 - - - 0;
#X obj 981 186 expr $f1 * $f2;
#X listbox 981 234 7 0 0 0 - - - 0;
#X obj 1086 210 +;
#X obj 1104 186 r win;
#X listbox 1086 234 7 0 0 0 - - - 0;
#X text 1084 251 End sample;
#X text 978 251 Start sample;
#X obj 1076 162 r hop;
#X text 1045 138 NO PADDING;
#X obj 982 311 r calc;
#X floatatom 982 334 5 0 0 0 - - - 0;
#X listbox 982 406 7 0 0 0 - - - 0;
#X obj 1127 382 +;
#X obj 1145 358 r win;
#X listbox 1127 406 7 0 0 0 - - - 0;
#X text 1125 423 End sample;
#X text 979 423 Start sample;
#X obj 1057 334 r hop;
#X obj 982 358 expr ($f1*$f2)-($f3/2);
#X obj 1133 334 r win;
#X text 1046 310 DEFAULT PADDING;
#X obj 982 503 r calc;
#X floatatom 982 526 5 0 0 0 - - - 0;
#X listbox 982 598 7 0 0 0 - - - 0;
#X obj 1140 575 +;
#X obj 1158 550 r win;
#X listbox 1140 599 7 0 0 0 - - - 0;
#X text 1138 616 End sample;
#X text 979 615 Start sample;
#X obj 1064 526 r hop;
#X obj 1147 526 r win;
#X text 1046 502 FULL PADDING;
#X obj 982 550 expr ($f1*$f2)-($f3-$f2);
#X obj 848 186 tabread confidence;
#X listbox 848 234 9 0 0 0 - - - 0;
#X obj 848 358 tabread confidence;
#X listbox 848 406 9 0 0 0 - - - 0;
#X obj 848 551 tabread confidence;
#X listbox 848 599 9 0 0 0 - - - 0;
#X text 846 251 Confidence;
#X text 845 423 Confidence;
#X text 845 619 Confidence;
#X text 997 106 FORMULAS;
#X obj 141 93 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X text 140 91 .. select a padding mode, f 12;
#X obj 284 91 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X text 283 89 .. Play with the window and hop sizes to see how the patch reacts, f 33;
#X text 150 524 0;
#X obj 655 331 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X obj 655 461 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X text 654 459 .. The red line shows the pitch confidence in relation to the sine waves, f 17;
#X obj 845 164 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X text 844 162 .. Change the frame;
#X obj 846 336 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X text 845 334 .. Change the frame;
#X obj 846 527 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X text 845 525 .. Change the frame;
#X obj 1188 157 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X text 1187 155 .. The first frame stats at zeroth sample, f 14;
#X obj 1196 335 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X text 1195 333 .. The first frame stats negative half the window size, f 14;
#X obj 1212 532 cnv 15 15 15 empty empty empty 20 12 0 14 #c6ffc7 #404040 0;
#X text 1211 530 .. The first frame stats negative window size-hopsize, f 14;
#X text 326 161 WINDOW SIZE, f 6;
#X text 421 162 HOP SIZE;
#X text 678 36 Assuming the audio starts at the zeroth sample \, without padding the first half window of samples will be attenuated and not be equally weighted against the later samples. If we use padding \, the windowing will begin before the zeroth sample (and end after the final sample). This uses more windows but allows the first samples to be treated equally., f 87;
#X text 667 22 WHY USE PADDING?;
#X obj 113 19 cnv 19 220 30 empty empty Where\ is\ My\ Data 15 15 0 20 #00faff #ffffff 0;
#X text 297 524 1024;
#X text 467 525 2048, f 5;
#X text 619 526 3072;
#X text 51 608 In the default state of the patch \, the pitch/confidence outputs are symmetrical. This is because the window size fits perfectly into the buffer size. This means that the median output will always contain the full 1024 samples of sine wave. This is true as long as the window size is 1024 and the hopsize is a division of 1024, f 109;
#X text 654 329 .. fluid.waveform displays 1024 samples of silence \, 1024 samples of a sine wave \, then 1024 samples of silence., f 17;
#X connect 1 0 3 0;
#X connect 3 0 4 0;
#X connect 3 1 9 0;
#X connect 4 0 8 0;
#X connect 5 0 1 0;
#X connect 8 0 7 0;
#X connect 9 0 11 0;
#X connect 12 0 16 0;
#X connect 16 0 29 0;
#X connect 16 1 28 0;
#X connect 16 2 5 0;
#X connect 16 3 17 0;
#X connect 17 0 1 0;
#X connect 18 0 1 0;
#X connect 19 0 12 0;
#X connect 20 0 18 0;
#X connect 21 0 18 1;
#X connect 22 0 12 0;
#X connect 23 0 22 0;
#X connect 24 0 25 0;
#X connect 25 0 20 0;
#X connect 26 0 27 0;
#X connect 27 0 21 0;
#X connect 29 0 30 0;
#X connect 29 1 31 0;
#X connect 29 2 32 0;
#X connect 36 0 37 0;
#X connect 37 0 38 0;
#X connect 37 0 71 0;
#X connect 38 0 39 0;
#X connect 38 0 40 0;
#X connect 40 0 42 0;
#X connect 41 0 40 1;
#X connect 45 0 38 1;
#X connect 47 0 48 0;
#X connect 48 0 56 0;
#X connect 48 0 73 0;
#X connect 50 0 52 0;
#X connect 51 0 50 1;
#X connect 55 0 56 1;
#X connect 56 0 49 0;
#X connect 56 0 50 0;
#X connect 57 0 56 2;
#X connect 59 0 60 0;
#X connect 60 0 70 0;
#X connect 60 0 75 0;
#X connect 62 0 64 0;
#X connect 63 0 62 1;
#X connect 67 0 70 1;
#X connect 68 0 70 2;
#X connect 70 0 61 0;
#X connect 70 0 62 0;
#X connect 71 0 72 0;
#X connect 73 0 74 0;
#X connect 75 0 76 0;
